<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adventure Card Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007acc;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a9e;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 3px;
        }
        .error {
            color: #d32f2f;
        }
        .success {
            color: #2e7d32;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Adventure Card Testing</h1>
        
        <div class="test-section">
            <h2>Test Loading Adventure Cards</h2>
            <p>This will test loading adventure cards like "Gumdrop Poisoner" and verify they work correctly.</p>
            <button class="test-button" onclick="testAdventureCards()">Test Adventure Cards</button>
            <button class="test-button" onclick="testIndividualParts()">Test Individual Parts</button>
            <button class="test-button" onclick="testFullResolution()">Run Full Test Suite</button>
            <div id="adventure-results" class="result"></div>
        </div>

        <div class="test-section">
            <h2>Cache Information</h2>
            <button class="test-button" onclick="showCacheStats()">Show Cache Stats</button>
            <button class="test-button" onclick="clearCache()">Clear Cache</button>
            <div id="cache-results" class="result"></div>
        </div>

        <div class="test-section">
            <h2>Card Details</h2>
            <input type="text" id="cardName" placeholder="Enter card name..." style="padding: 8px; width: 300px;">
            <button class="test-button" onclick="searchCard()">Search Card</button>
            <div id="card-details" class="result"></div>
        </div>
    </div>

    <script type="module">
        import ScryfallCache from '../scryfallCache.js';
        
        // Make ScryfallCache available globally for the buttons
        window.ScryfallCache = ScryfallCache;
        
        window.testAdventureCards = async function() {
            const resultsDiv = document.getElementById('adventure-results');
            resultsDiv.innerHTML = '<p>Loading adventure cards...</p>';
            
            try {
                const adventureCards = [
                    'Gumdrop Poisoner // Tempt with Treats',
                    'Curious Pair // Treats to Share',
                    'Giant Killer // Chop Down'
                ];
                
                await ScryfallCache.load(adventureCards, (loaded, total, current) => {
                    resultsDiv.innerHTML = `<p>Loading: ${loaded}/${total} - ${current}</p>`;
                });
                
                let results = '<h3>Results:</h3>';
                adventureCards.forEach(cardName => {
                    const card = ScryfallCache.get(cardName);
                    if (card) {
                        results += `<div class="success">✅ ${cardName}</div>`;
                        results += `<div>Layout: ${card.layout}</div>`;
                        if (card.card_faces) {
                            results += `<div>Faces: ${card.card_faces.map(f => f.name).join(' | ')}</div>`;
                        }
                        results += `<div>Is Adventure: ${ScryfallCache.isAdventureCard(cardName)}</div>`;
                        results += `<div>Has Back Face: ${ScryfallCache.hasBackFace(cardName)}</div>`;
                        results += '<hr>';
                    } else {
                        results += `<div class="error">❌ Failed to load: ${cardName}</div>`;
                    }
                });
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        };
        
        window.testIndividualParts = async function() {
            const resultsDiv = document.getElementById('adventure-results');
            resultsDiv.innerHTML = '<p>Testing individual parts...</p>';
            
            try {
                const individualParts = [
                    'Gumdrop Poisoner',
                    'Tempt with Treats',
                    'Curious Pair',
                    'Treats to Share'
                ];
                
                await ScryfallCache.load(individualParts, (loaded, total, current) => {
                    resultsDiv.innerHTML = `<p>Loading: ${loaded}/${total} - ${current}</p>`;
                });
                
                let results = '<h3>Individual Parts Results:</h3>';
                individualParts.forEach(cardName => {
                    const card = ScryfallCache.get(cardName);
                    if (card) {
                        results += `<div class="success">✅ ${cardName} → ${card.name}</div>`;
                        const fullName = ScryfallCache.getFullCardName(cardName);
                        results += `<div>Full name: ${fullName}</div>`;
                        if (ScryfallCache.isAdventureCard(cardName)) {
                            results += `<div>Creature: ${ScryfallCache.getCreatureName(cardName)}</div>`;
                            results += `<div>Adventure: ${ScryfallCache.getAdventureSpellName(cardName)}</div>`;
                        }
                        results += '<hr>';
                    } else {
                        results += `<div class="error">❌ Failed to load: ${cardName}</div>`;
                    }
                });
                
                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        };
        
        window.testFullResolution = async function() {
            const resultsDiv = document.getElementById('adventure-results');
            resultsDiv.innerHTML = '<p>Running full test suite...</p>';
            
            // Capture console output
            const originalLog = console.log;
            let consoleOutput = '';
            console.log = function(...args) {
                consoleOutput += args.join(' ') + '\n';
                originalLog.apply(console, arguments);
            };
            
            try {
                await ScryfallCache.testCardResolution();
                
                resultsDiv.innerHTML = `<h3>Test Suite Complete</h3><pre>${consoleOutput}</pre>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div><pre>${consoleOutput}</pre>`;
            } finally {
                console.log = originalLog;
            }
        };
        
        window.showCacheStats = function() {
            const resultsDiv = document.getElementById('cache-results');
            const stats = ScryfallCache.getCacheStats();
            resultsDiv.innerHTML = `<pre>${JSON.stringify(stats, null, 2)}</pre>`;
        };
        
        window.clearCache = function() {
            ScryfallCache.clearCache();
            document.getElementById('cache-results').innerHTML = '<div class="success">Cache cleared!</div>';
        };
        
        window.searchCard = async function() {
            const cardName = document.getElementById('cardName').value.trim();
            const resultsDiv = document.getElementById('card-details');
            
            if (!cardName) {
                resultsDiv.innerHTML = '<div class="error">Please enter a card name</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<p>Searching...</p>';
            
            try {
                await ScryfallCache.load([cardName]);
                const card = ScryfallCache.get(cardName);
                
                if (card) {
                    let details = `<h3>${card.name}</h3>`;
                    details += `<div><strong>Layout:</strong> ${card.layout}</div>`;
                    details += `<div><strong>Type:</strong> ${card.type_line}</div>`;
                    details += `<div><strong>Is Adventure:</strong> ${ScryfallCache.isAdventureCard(cardName)}</div>`;
                    details += `<div><strong>Has Back Face:</strong> ${ScryfallCache.hasBackFace(cardName)}</div>`;
                    
                    if (card.card_faces && card.card_faces.length > 1) {
                        details += '<h4>Card Faces:</h4>';
                        card.card_faces.forEach((face, index) => {
                            details += `<div><strong>Face ${index + 1}:</strong> ${face.name} (${face.type_line})</div>`;
                        });
                    }
                    
                    if (card.image_uris && card.image_uris.normal) {
                        details += `<div><img src="${card.image_uris.normal}" alt="${card.name}" style="max-width: 300px; margin: 10px 0;"></div>`;
                    }
                    
                    resultsDiv.innerHTML = details;
                } else {
                    resultsDiv.innerHTML = '<div class="error">Card not found</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        };
    </script>
</body>
</html>
