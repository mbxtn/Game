<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Size Selection Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .demo-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .demo-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-width: 300px;
        }
        .card-demo {
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
            margin: 10px;
            display: inline-block;
            position: relative;
        }
        .card-demo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .size-label {
            position: absolute;
            top: 2px;
            left: 2px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a9e;
        }
        .controls {
            margin: 20px 0;
        }
        .size-info {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .current-settings {
            background: #f0f8ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Dynamic Image Size Selection Demo</h1>
    <p>This demo shows how the cardFactory automatically selects the optimal Scryfall image size based on card width.</p>
    
    <div class="size-info">
        <h3>Scryfall Image Sizes:</h3>
        <ul>
            <li><strong>small:</strong> 146×204 pixels - For small cards (≤100px width)</li>
            <li><strong>normal:</strong> 488×680 pixels - For medium cards (101-200px width)</li>
            <li><strong>large:</strong> 672×936 pixels - For large cards (>200px width)</li>
        </ul>
    </div>
    
    <div class="controls">
        <button onclick="loadTestCard()">Load Test Card</button>
        <button onclick="clearAll()">Clear All</button>
        <br><br>
        <label>
            Card Width: 
            <input type="range" id="cardWidthSlider" min="40" max="400" value="80" 
                   onchange="updateCardSize(this.value)">
            <span id="cardWidthValue">80px</span>
        </label>
    </div>
    
    <div class="current-settings" id="currentSettings">
        Current Width: 80px → Using: small images (146×204)
    </div>
    
    <div class="demo-container">
        <div class="demo-section">
            <h3>Auto-Selected Size</h3>
            <p>Automatically chooses optimal size based on card width</p>
            <div id="auto-cards"></div>
        </div>
        
        <div class="demo-section">
            <h3>All Sizes Comparison</h3>
            <p>Shows all available sizes at the same display size</p>
            <div id="size-comparison"></div>
        </div>
    </div>
    
    <script type="module">
        // Sample high-quality card for testing
        const testCardData = {
            name: 'Lightning Bolt',
            id: 'test-card-' + Date.now(),
            displayName: 'Lightning Bolt'
        };
        
        // Mock Scryfall data with all image sizes
        const mockScryfallData = {
            name: 'Lightning Bolt',
            image_uris: {
                small: 'https://cards.scryfall.io/small/front/3/1/310a43c4-4e7e-44de-b69a-e4ac129221dd.jpg?1562906514',
                normal: 'https://cards.scryfall.io/normal/front/3/1/310a43c4-4e7e-44de-b69a-e4ac129221dd.jpg?1562906514',
                large: 'https://cards.scryfall.io/large/front/3/1/310a43c4-4e7e-44de-b69a-e4ac129221dd.jpg?1562906514',
                png: 'https://cards.scryfall.io/png/front/3/1/310a43c4-4e7e-44de-b69a-e4ac129221dd.png?1562906514'
            }
        };
        
        // Mock the ScryfallCache for testing
        window.ScryfallCache = {
            get: (name) => name === 'Lightning Bolt' ? mockScryfallData : null,
            getCardBack: (name) => './cardback.png'
        };
        
        let currentCardWidth = 80;
        
        // Import our functions from cardFactory
        import { createCardElement } from './cardFactory.js';
        
        window.loadTestCard = async function() {
            const autoContainer = document.getElementById('auto-cards');
            const comparisonContainer = document.getElementById('size-comparison');
            
            autoContainer.innerHTML = '';
            comparisonContainer.innerHTML = '';
            
            // Set CSS variable for current card width
            document.documentElement.style.setProperty('--card-width', currentCardWidth + 'px');
            
            try {
                // Create auto-sized card
                const autoCard = await createCardElement(testCardData, 'test', {
                    isMagnifyEnabled: false,
                    isInteractable: false
                });
                
                const autoCardContainer = document.createElement('div');
                autoCardContainer.className = 'card-demo';
                autoCardContainer.style.width = currentCardWidth + 'px';
                autoCardContainer.style.height = Math.round(currentCardWidth * (107/80)) + 'px';
                
                autoCardContainer.appendChild(autoCard);
                autoContainer.appendChild(autoCardContainer);
                
                // Create comparison cards for each size
                const sizes = ['small', 'normal', 'large'];
                for (const size of sizes) {
                    const img = document.createElement('img');
                    img.src = mockScryfallData.image_uris[size];
                    img.alt = `Lightning Bolt (${size})`;
                    
                    const cardContainer = document.createElement('div');
                    cardContainer.className = 'card-demo';
                    cardContainer.style.width = currentCardWidth + 'px';
                    cardContainer.style.height = Math.round(currentCardWidth * (107/80)) + 'px';
                    
                    const label = document.createElement('div');
                    label.className = 'size-label';
                    label.textContent = size.toUpperCase();
                    
                    cardContainer.appendChild(img);
                    cardContainer.appendChild(label);
                    comparisonContainer.appendChild(cardContainer);
                }
                
            } catch (error) {
                console.error('Error loading test card:', error);
                autoContainer.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        };
        
        window.updateCardSize = function(width) {
            currentCardWidth = parseInt(width);
            document.getElementById('cardWidthValue').textContent = width + 'px';
            
            // Update current settings display
            let selectedSize = 'small';
            if (currentCardWidth > 200) {
                selectedSize = 'large';
            } else if (currentCardWidth > 100) {
                selectedSize = 'normal';
            }
            
            const resolutions = {
                small: '146×204',
                normal: '488×680',
                large: '672×936'
            };
            
            document.getElementById('currentSettings').textContent = 
                `Current Width: ${width}px → Using: ${selectedSize} images (${resolutions[selectedSize]})`;
            
            // Update CSS custom property
            document.documentElement.style.setProperty('--card-width', width + 'px');
            
            // Reload card with new sizing
            if (document.getElementById('auto-cards').children.length > 0) {
                loadTestCard();
            }
        };
        
        window.clearAll = function() {
            document.getElementById('auto-cards').innerHTML = '';
            document.getElementById('size-comparison').innerHTML = '';
        };
        
        // Initialize with default settings
        updateCardSize(80);
    </script>
</body>
</html>
